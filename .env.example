# =============================================================================
# SERVER CONFIGURATION
# =============================================================================

# HTTP server port
# Range: 1024-65535
# Default: 8080
# Production: Use standard ports (8080, 8443) or configure via reverse proxy
PORT=8080

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log output format
# Values: json (production) | console (development)
# Default: json
# Production: Always use "json" for structured logging and log aggregation
# Development: Use "console" for human-readable output
LOG_FORMAT=json

# =============================================================================
# GRAPHQL CONFIGURATION
# =============================================================================

# Path to GraphQL schema file
# Default: ./schema.graphqls
SCHEMA_PATH=./schema.graphqls

# =============================================================================
# AUTHENTICATION CONFIGURATION
# =============================================================================

# JWT signing secret
# CRITICAL: Must be at least 32 characters for security
# Generation: openssl rand -base64 32
# Production: Store in secure secret management system (e.g., AWS Secrets Manager, HashiCorp Vault)
# Development: Use a strong random value, never commit real secrets to version control
JWT_SECRET=your-secret-key-here-minimum-32-characters-recommended

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# Allowed CORS origins (comma-separated)
# Values: * (allow all) | specific origins
# Example: http://localhost:3000,https://app.example.com
# Production: NEVER use "*" - always specify exact origins
# Development: Use "*" for convenience or specify frontend dev server
CORS_ORIGINS=*

# =============================================================================
# MONGODB CONFIGURATION
# =============================================================================

# MongoDB connection string
# Format: mongodb://[username:password@]host[:port][/database][?options]
# Examples:
#   - Local: mongodb://localhost:27017
#   - Authenticated: mongodb://user:pass@localhost:27017/?authSource=admin
#   - Replica Set: mongodb://host1:27017,host2:27017,host3:27017/?replicaSet=rs0
#   - MongoDB Atlas: mongodb+srv://user:pass@cluster.mongodb.net/?retryWrites=true&w=majority
# Default: mongodb://localhost:27017
# Production: Use authenticated connection with TLS/SSL enabled
# Security: URL-encode special characters in username/password (@ becomes %40, : becomes %3A)
MONGODB_URI=mongodb://localhost:27017

# Database name
# Default: air_dev
# Production: Use environment-specific names (e.g., air_prod, air_staging)
MONGODB_DATABASE=air_dev

# =============================================================================
# MONGODB TIMEOUT CONFIGURATION
# =============================================================================

# Connection establishment timeout
# Range: 10s-60s (per FR-007)
# Default: 30s
# Success Criteria: Connection must establish within 30s (SC-003)
# Production: 30s recommended for network latency tolerance
# Development: 30s (adequate for local MongoDB)
MONGODB_TIMEOUT_CONNECT=30s

# Individual database operation timeout
# Range: 1s-30s (per FR-018)
# Default: 10s
# Success Criteria: Simple operations should complete in <100ms (SC-004)
# Production: 10s handles complex queries with network overhead
# Development: 10s
MONGODB_TIMEOUT_OPERATION=10s

# =============================================================================
# MONGODB CONNECTION POOL CONFIGURATION
# =============================================================================

# Minimum connection pool size
# Default: 5
# Production: 10 recommended for consistent performance under load
# Development: 5 is sufficient
# Note: Connections maintained even when idle (within idle timeout)
MONGODB_POOL_MIN=5

# Maximum connection pool size
# Range: 10-20 (per FR-006 specification)
# Default: 20
# Success Criteria: Pool must handle 10-20 concurrent operations (SC-006)
# Production: 20 (maximum allowed) for high concurrency
# Development: 10-15 is sufficient
# Warning: Values >20 will fail validation
MONGODB_POOL_MAX=20

# Connection idle timeout
# Default: 5m (5 minutes)
# Production: 5m balances connection reuse and resource cleanup
# Development: 5m
# Note: Connections idle longer than this are closed (but pool maintains minimum size)
MONGODB_POOL_IDLE_TIMEOUT=5m

# =============================================================================
# MONGODB RETRY CONFIGURATION
# =============================================================================

# Maximum retry attempts for transient failures
# Fixed: 3 (per FR-002 specification)
# Retry schedule: 1s, 2s, 10s (with Â±20% jitter)
# Note: This value is fixed by specification and should not be changed
MONGODB_RETRY_ATTEMPTS=3

# Base delay for first retry attempt
# Default: 1s
# Note: Actual delays follow exponential backoff: 1s, 2s, 10s with jitter
# Production: 1s is optimal for quick recovery
MONGODB_RETRY_BASE_DELAY=1s

# Maximum delay between retry attempts
# Default: 10s
# Note: Delays are capped at this value (third attempt uses 10s)
# Production: 10s prevents excessive wait times
MONGODB_RETRY_MAX_DELAY=10s

# =============================================================================
# ENVIRONMENT-SPECIFIC RECOMMENDATIONS
# =============================================================================

# Development:
#   - MONGODB_URI=mongodb://localhost:27017
#   - MONGODB_DATABASE=air_dev
#   - MONGODB_POOL_MAX=10
#   - LOG_FORMAT=console
#   - CORS_ORIGINS=*

# Production:
#   - MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/?retryWrites=true&w=majority&tls=true
#   - MONGODB_DATABASE=air_prod
#   - MONGODB_POOL_MIN=10
#   - MONGODB_POOL_MAX=20
#   - LOG_FORMAT=json
#   - CORS_ORIGINS=https://app.example.com
#   - JWT_SECRET=[64-character secure random string from secret manager]

# Testing (Integration Tests):
#   - Tests use testcontainers - no configuration needed
#   - Containers automatically started on random ports
#   - Clean database for each test
#   - Automatic cleanup after test completion

# =============================================================================
# SUCCESS CRITERIA VALIDATION
# =============================================================================

# These settings ensure all success criteria are met:
#   SC-001: Graceful startup with retry logic (MONGODB_RETRY_ATTEMPTS=3)
#   SC-002: Test cleanup <2s (handled by test framework)
#   SC-003: Connection establishment <30s (MONGODB_TIMEOUT_CONNECT=30s)
#   SC-004: Simple operations <100ms (MONGODB_TIMEOUT_OPERATION=10s with margin)
#   SC-005: Structured logging (LOG_FORMAT=json)
#   SC-006: Pool handles 10-20 concurrent ops (MONGODB_POOL_MAX=20)
#   SC-007: Graceful degradation (automatic retry with exponential backoff)
#   SC-008: Health check <1s (Ping operation with timeout)
#   SC-009: RFC3339 timestamps (automatic in structured logging)
